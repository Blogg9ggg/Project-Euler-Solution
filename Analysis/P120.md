易知 $n=0$ 时，$r=2$. 现只考虑 $n>0$ :

$$
(a-1)^n={C^0_n}a^n-{C^1_n}a^{n-1}+.....+(-1)^{n-2}{C^{n-2}_n}a^{2}+(-1)^{n-1}{C^{n-1}_n}a+(-1)^{n} \tag{1}
$$

$$
(a-1)^n  \equiv (-1)^{n-1}{C^{n-1}_n}a+(-1)^{n} \ (Mod \ {a^2}) \tag{2}
$$

$$
(a+1)^n={C^0_n}a^n+{C^1_n}a^{n-1}+.....+{C^{n-2}_n}a^{2}+{C^{n-1}_n}a+1 \tag{3}
$$

$$
(a+1)^n  \equiv {C^{n-1}_n}a+1 \ (Mod \ {a^2})  \tag{4}
$$

式(2)+式(4):
$$
(a-1)^n+(a+1)^n  \equiv (-1)^{n-1}na+(-1)^{n}+na+1 \ (Mod \ {a^2}) \tag{5}
$$

若 n 为偶数，则式(5):
$$
(a-1)^n+(a+1)^n  \equiv 2 \ (Mod \ {a^2}) \tag{5a}
$$

若 n 为奇数，则式(5):
$$
(a-1)^n+(a+1)^n  \equiv 2na \ (Mod \ {a^2}) \tag{5b}
$$
不难推断：$r_{max}$ 一定是出现在 $n$ 为奇数的时候，根据式(5b)，记录循环节，暴搜即可。
